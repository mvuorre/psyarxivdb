title: PsyArXiv Datasette
description_html: |-
  <div>
  <strong>PsyArXiv Datasette</strong> is a <a href="https://datasette.io/">Datasette</a> database instance serving (de)normalized tables of <a href="https://psyarxiv.com/">PsyArXiv</a> preprint metadata from the <a href="https://osf.io/preprints/">Open Science Framework</a> <a href="https://api.osf.io/v2/preprints/">API</a>. Its purpose is to make these (de)normalized data highly available for analyses, webapps, and other uses that require fast access and regular updates. The database is updated daily.
  </div>
  <div>
  <h3>Sources and licenses</h3>
  <p>
  The code used to create this database is available under the MIT license at <a href="https://github.com/mvuorre/osfdatasette">https://github.com/mvuorre/osfdatasette</a>. All preprints retain their original licenses as indicated in the data; OSF API is used with gratitude and respect.
  </p>
  </div>
license: ODbL (database) & original licenses (content)
license_url: https://opendatacommons.org/licenses/odbl/
source: Open Science Framework
source_url: https://osf.io/preprints/
databases:
  preprints:
    title: PsyArXiv Preprints
    description_html: |-
      <div>
      <p>
      Browse the database tables below or construct custom SQL queries. See <a href="https://datasette.io/docs/">Datasette's documentation</a> for help. Variables in data closely follow the <a href="https://developer.osf.io/#tag/Preprints">Open Science Framework API documentation</a>.
      </p>
      </div>
    source: Open Science Framework
    source_url: https://developer.osf.io/#tag/Preprints
    tables:
      preprints:
        title: Preprints
        description: Core metadata for each PsyArXiv preprint
        size: 10
        sort_desc: date_created
      raw_data:
        hidden: true
    queries:
      preprints_by_time:
        title: "PsyArXiv preprints over time"
        hide_sql: true
        sql: |-
          WITH time_data AS (
            SELECT
              -- Get time ranges for different granularities
              date(date_created) as day,
              strftime('%Y-%W', date_created) as week,
              strftime('%Y-%m', date_created) as month,
              strftime('%Y', date_created) as year,
              COUNT(*) as count
            FROM
              preprints
            WHERE
              date_created IS NOT NULL
            GROUP BY
              CASE :granularity
                WHEN 'day' THEN day
                WHEN 'week' THEN week
                WHEN 'month' THEN month
                WHEN 'year' THEN year
              END
          )
          SELECT
            CASE :granularity
              WHEN 'day' THEN day
              WHEN 'week' THEN week 
              WHEN 'month' THEN month
              WHEN 'year' THEN year
            END as time_period,
            count
          FROM
            time_data
          ORDER BY
            CASE :granularity
              WHEN 'day' THEN day
              WHEN 'week' THEN week
              WHEN 'month' THEN month 
              WHEN 'year' THEN year
            END
plugins:
  datasette-vega:
    charts:
      time_series:
        title: "PsyArXiv Preprints Created Over Time"
        database: preprints
        canned_query: preprints_by_time
        library: vega-lite
        default_parameters:
          granularity: "month"
        chart: {
          "mark": "line",
          "encoding": {
            "x": {
              "field": "time_period", 
              "type": "temporal", 
              "title": "Time Period"
            },
            "y": {
              "field": "count", 
              "type": "quantitative", 
              "title": "Number of Preprints"
            },
            "tooltip": [
              {"field": "time_period", "type": "temporal", "title": "Date"},
              {"field": "count", "type": "quantitative", "title": "Preprints"}
            ]
          }
        }